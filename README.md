# CopaCmd 使用說明

## 1. 環境需求

- .NET 6 SDK
- MySQL 或相容資料庫
- 已正確設定 `appsettings.json` 連線資訊

## 2. 安裝與編譯

1. 下載或 clone 專案原始碼
2. 於專案根目錄執行：dotnet restore
   dotnet build
## 3. 執行方式

### 3.1 常駐排程模式（預設）

直接執行程式，啟動常駐排程服務：Copacmd.exe
### 3.2 指定排程代碼執行

可用參數指定要執行的排程代碼與參數：Copacmd.exe -- -c <排程代碼> [-p <參數內容>]
#### 參數說明

| 參數 | 必填 | 說明         |
|------|------|--------------|
| -c, --Code  | 是   | 排程代碼（參見下方排程代碼清單） |
| -p, --Paras | 否   | 排程所需參數（詳見各代碼說明）    |

#### 範例
# ERP資料轉移，指定特定日期
Copacmd.exe -- -c J06 -p "2024-06-01"

# 機台日報表，指定特定日期
Copacmd.exe -- -c J04 -p "startDate=2024-06-01"

# 取得機台紀錄（無參數）
Copacmd.exe -- -c J02

# 清除Log紀錄（無參數）
Copacmd.exe -- -c J05
## 4. 支援的排程代碼

| 代碼 | 功能說明 | 參數需求 | 日期格式 | 備註 |
|------|----------|----------|----------|------|
| J01  | 尚未實作 | - | - | 未實作功能 |
| J02  | 取得機台紀錄 | 無 | - | 智慧電表資料收集 |
| J03  | 更新機台生產總時間 | 依設定檔 | - | 計算機台生產時間統計 |
| J04  | 計算機台日報表 | 可選：`startDate=日期` | yyyy-MM-dd | 產生機台日報表，未指定則使用當日 |
| J05  | 清除Log紀錄 | 依設定檔 | - | 清理系統紀錄 |
| J06  | ERP資料轉移 | **必填：日期** | **yyyy-MM-dd** | 從ERP同步製令、派工單資料 |
| J07  | 更新機台狀態 | 可選：`startDate=日期` | yyyy-MM-dd | 計算機台電力報表，未指定則使用當日 |
| J11  | 更新客戶資料 | 依設定檔 | - | 同步客戶主檔資料 |
| J12  | 更新客戶訂單資料 | 依設定檔 | - | 同步客戶訂單資料 |
| J13  | 成本分析 | 依設定檔 | - | 工單成本分析計算 |

### 日期參數說明

#### J06 (ERP資料轉移) - 必填日期參數
- **參數格式**: 直接提供日期字串
- **日期格式**: `yyyy-MM-dd`
- **範例**: Copacmd.exe -- -c J06 -p "2024-06-01"- **說明**: 取得指定日期的ERP製令、派工單資訊

#### J04 (計算機台日報表) - 可選日期參數
- **參數格式**: `startDate=日期`
- **日期格式**: `yyyy-MM-dd`
- **範例**: Copacmd.exe -- -c J04 -p "startDate=2024-06-01"
Copacmd.exe -- -c J04  # 使用當日日期
#### J07 (更新機台狀態) - 可選日期參數
- **參數格式**: `startDate=日期`
- **日期格式**: `yyyy-MM-dd`
- **範例**: Copacmd.exe -- -c J07 -p "startDate=2024-06-01"
Copacmd.exe -- -c J07  # 使用當日日期
## 5. 設定說明

- 請於 `appsettings.json` 設定資料庫連線字串與日誌等相關參數。
- 排程任務設定於 Jobs 區段。

## 6. 日誌

- 日誌採用 Serilog，輸出路徑與格式可於 `appsettings.json` 調整。

## 7. 常見問題

- **Q:** 執行時顯示「常註排程已運作，請勿重復執行」？
  - **A:** 代表已有一個常駐排程正在執行，請勿重複啟動。

- **Q:** 如何新增排程？
  - **A:** 請於 Jobs 設定區段新增排程資訊，並實作對應 Job 類別。

- **Q:** 執行時顯示「無此排程代碼」？
  - **A:** 請確認輸入的代碼是否正確，參考上方支援的排程代碼表。

- **Q:** J06 (ERP資料轉移) 需要什麼參數？
  - **A:** 必須提供日期參數，格式為 `yyyy-MM-dd`，例如：`-p "2024-06-01"`

- **Q:** 日期格式錯誤怎麼辦？
  - **A:** 請確保日期格式為 `yyyy-MM-dd`，例如：2024-06-01、2024-12-25

- **Q:** J04、J07 的日期參數是否必填？
  - **A:** 不必填，若不提供日期參數則使用當日日期進行處理。

---
